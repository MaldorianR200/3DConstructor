<app-stack direction="column" class="form">
  <h1 class="adminTitle">
    {{ isCreate ? "Создание" : "Редактирование" }} фрезеровок
  </h1>

  <app-admin-form [form]="millingForm" (handleSubmit)="submit()">
    <app-stack direction="column" alignItems="end">
      <app-admin-input
        [control]="millingForm.get('name')!"
        [props]="{
          id: 'millingName',
          type: 'text',
          required: true,
          placeholder: 'Введите название',
        }"
      ></app-admin-input>

      <app-admin-input
        [control]="millingForm.get('steps')!"
        [props]="{
          id: 'millingSteps',
          type: 'select',
          required: false,
          placeholder: 'Выберите шаги',
          multiple: true,
        }"
        [options]="steps"
        optionLabel="label"
        optionValue="value"
      ></app-admin-input>
      <app-stack
        direction="column"
        class="selected-items"
        border="table"
        *ngIf="getStepArray()?.controls?.length > 0"
      >
        <!-- Шапка таблицы -->
        <app-header-table grid="other-grid" style="width: 100%"></app-header-table>

        <!-- Строки таблицы -->
        <ng-container *ngFor="let control of getStepArray().controls; let i = index">
          <app-specification-row grid="grid">
            <span></span>
            <span>{{ getOptionLabel(control.get('typeStepId')?.value) }}</span>
            <app-admin-input
              [control]="control.get('price')!"
              [props]="{
                id: 'stepPrice' + i,
                type: 'number',
                required: true,
                placeholder: 'Себестоимость(₽)',
              }"
            ></app-admin-input>

            <app-admin-input
              [control]="control.get('count')!"
              [props]="{
                id: 'stepCount' + i,
                type: 'number',
                required: true,
                placeholder: 'Количество повторений',
              }"
            ></app-admin-input>
            <span class="step-total">
            {{
                          ((control.get('price')?.value || 0) * (control.get('count')?.value || 0))
                            | number:'1.0-3'
                        }} ₽
          </span>
          </app-specification-row>

        </ng-container>
        <app-specification-row grid="grid">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          <span class="total">Общая стоимость:  <span class="total-cost">{{ totalCost | number:'1.0-3' }} ₽/м²</span></span>
        </app-specification-row>
      </app-stack>

      <app-admin-input
        [control]="millingForm.get('active')!"
        [props]="{
          id: 'millingActive',
          type: 'select',
          required: true,
          placeholder: 'Активно?',
          optionsBool: true,
        }"
      ></app-admin-input>

      <app-admin-input
        *ngIf="millingForm.get('active')?.value === false"
        [control]="millingForm.get('comment')!"
        [props]="{
          id: 'millingComment',
          type: 'text',
          required: false,
          placeholder: 'Введите комментарий',
        }"
      ></app-admin-input>

      <app-stack>
        <app-admin-button
          *ngIf="!isCreate"
          (handleClick)="deleteChangeOpen()"
          variant="red"
          >Удалить</app-admin-button
        >

        <app-admin-button type="submit">{{
          isCreate ? "Создать" : "Редактировать"
        }}</app-admin-button>
      </app-stack>
    </app-stack>
  </app-admin-form>
</app-stack>

<!-- Модалка удаления -->
<app-admin-modal
  [isOpen]="isOpenDelete"
  (handleChangeOpen)="deleteChangeOpen()"
>
  <app-stack direction="column" alignItems="center">
    <h4 class="adminTitle">Вы действительно хотите удалить?</h4>

    <app-stack>
      <app-admin-button (handleClick)="deleteChangeOpen()" variant="gray"
        >Отмена</app-admin-button
      >
      <app-admin-button (handleClick)="delete()" variant="red"
        >Удалить</app-admin-button
      >
    </app-stack>
  </app-stack>
</app-admin-modal>
